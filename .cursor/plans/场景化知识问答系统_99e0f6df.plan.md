---
name: 场景化知识问答系统
overview: ""
todos: []
---

# 场景化知识问答系统完整设计

## 一、系统整体架构

```mermaid
flowchart TD
    subgraph Input [用户输入层]
        UserQuery[用户问题]
        UserResponse[用户回复澄清]
    end
    
    subgraph ContextLayer [Context管理层]
        ContextLoader[加载会话Context]
        ContextUpdater[更新Context]
        HistoryCompressor[历史压缩器]
        EntityExtractor[实体提取器]
    end
    
    subgraph IntentLayer [意图识别层]
        IntentRecognizer[意图识别器]
        SceneClassifier[场景分类器]
        ClarifyDecider[澄清决策器]
    end
    
    subgraph ClarifyLayer [澄清交互层]
        QuestionnaireGen[问卷生成器]
        ResponseParser[回复解析器]
        AnswerCollector[答案收集器]
    end
    
    subgraph RetrievalLayer [知识检索层]
        KURouter[KU路由器]
        GeneralSearch[通用检索]
        ScenarioSearch[场景检索]
        MultiSceneSearch[多场景融合]
    end
    
    subgraph GenerationLayer [生成层]
        PromptBuilder[Prompt构建器]
        LLMGateway[LLM网关]
        ResponseFormatter[响应格式化]
    end
    
    UserQuery --> ContextLoader
    ContextLoader --> IntentRecognizer
    IntentRecognizer --> SceneClassifier
    SceneClassifier --> ClarifyDecider
    
    ClarifyDecider -->|需要澄清| QuestionnaireGen
    QuestionnaireGen --> UserResponse
    UserResponse --> ResponseParser
    ResponseParser --> AnswerCollector
    AnswerCollector --> ContextUpdater
    ContextUpdater --> SceneClassifier
    
    ClarifyDecider -->|无需澄清| KURouter
    KURouter -->|通用| GeneralSearch
    KURouter -->|单场景| ScenarioSearch
    KURouter -->|多场景| MultiSceneSearch
    
    GeneralSearch --> PromptBuilder
    ScenarioSearch --> PromptBuilder
    MultiSceneSearch --> PromptBuilder
    
    PromptBuilder --> LLMGateway
    LLMGateway --> ResponseFormatter
    ResponseFormatter --> ContextUpdater
```

---

## 二、核心模块设计

### 2.1 意图识别模块

**输入**: 用户问题 + 历史Context

**输出**: 意图类型 + 置信度 + 场景分类

#### 意图类型定义

| 意图类型 | 说明 | 典型问法 | 是否需要KU |

|---------|------|---------|-----------|

| solution_recommendation | 方案推荐 | "推荐一个XX方案" | 是 |

| technical_qa | 技术问答 | "XX怎么配置" | 是 |

| troubleshooting | 故障诊断 | "XX报错怎么办" | 是 |

| comparison | 对比分析 | "XX和YY有什么区别" | 是 |

| concept_explain | 概念解释 | "什么是XX" | 是 |

| best_practice | 最佳实践 | "XX有哪些最佳实践" | 是 |

| how_to | 操作指南 | "如何做XX" | 是 |

| general_chat | 闲聊/通用 | "你好"、"谢谢" | 否 |

#### 场景分类逻辑

```mermaid
flowchart TD
    Query[用户问题] --> KeywordMatch[关键词匹配]
    KeywordMatch --> MatchCount{匹配场景数}
    
    MatchCount -->|0个| CheckGeneral{是否通用问题}
    CheckGeneral -->|是闲聊| GeneralNoKU[通用-无需KU]
    CheckGeneral -->|需专业回答| GeneralWithKU[通用-需检索KU]
    
    MatchCount -->|1个| SingleScene[单一场景]
    MatchCount -->|多个| MultiScene[复合场景]
    
    SingleScene --> CheckContext{检查历史Context}
    MultiScene --> CheckContext
    
    CheckContext -->|Context一致| KeepScene[保持场景]
    CheckContext -->|Context不同| MergeScene[合并场景]
```

---

### 2.2 澄清交互模块

#### 澄清触发条件

| 条件 | 说明 | 示例 |

|------|------|------|

| 场景模糊 | 匹配到多个场景，无法确定主场景 | "推荐一个安全方案"（网络安全？数据安全？） |

| 信息不足 | 方案推荐类缺少关键上下文 | "推荐一个AOI方案"（产品类型？预算？） |

| 问题过于宽泛 | 问题范围太大，无法给出精准回答 | "怎么做质量检测" |

| 首次交互 | 新用户首次提问复杂问题 | - |

#### Questionnaire 问题类型

| 问题类型 | 格式 | 适用场景 |

|---------|------|---------|

| single_choice | 单选（1-5选一） | 场景选择、规模选择 |

| multi_choice | 多选（可选多个） | 关注维度、需求特征 |

| text | 自由文本 | 补充描述、错误信息 |

| scale | 量表（1-5分） | 优先级评估 |

#### 澄清问题库设计

**按意图分类的标准问题：**

**方案推荐类 (solution_recommendation):**

1. 企业规模/团队规模
2. 预算范围
3. 技术能力水平
4. 实施时间要求
5. 核心痛点（开放式）

**故障诊断类 (troubleshooting):**

1. 具体错误信息/现象
2. 发生时间/频率
3. 最近的变更操作
4. 影响范围
5. 已尝试的解决方法

**对比分析类 (comparison):**

1. 关注的对比维度（成本/性能/易用性等）
2. 应用场景
3. 决策时间点

#### 问卷呈现格式

```

🤔 为了给您更精准的建议，请回答以下问题：

**问题1：您的产品类型是？** (必填，回复数字)

1. PCB/电路板
2. 电子元器件
3. 外观件/结构件
4. 其他（请说明）

**问题2：检测的核心需求是？** (可多选，回复数字如"1,