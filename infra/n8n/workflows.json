[
  {
    "name": "Document Processing Notification",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "document-processed",
          "responseMode": "lastNode"
        },
        "name": "Webhook",
        "type": "n8n-nodes-base.webhook",
        "position": [250, 300]
      },
      {
        "parameters": {
          "url": "http://api:8000/v1/kg/import",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {"name": "text", "value": "={{ $json.title }} {{ $json.summary }}"},
              {"name": "extract_relations", "value": "true"}
            ]
          }
        },
        "name": "Import to KG",
        "type": "n8n-nodes-base.httpRequest",
        "position": [450, 300]
      }
    ],
    "connections": {
      "Webhook": {"main": [[{"node": "Import to KG", "type": "main", "index": 0}]]}
    }
  },
  {
    "name": "Daily Feedback Analysis",
    "nodes": [
      {
        "parameters": {
          "rule": {"interval": [{"field": "hours", "hoursInterval": 24}]}
        },
        "name": "Daily Trigger",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [250, 300]
      },
      {
        "parameters": {
          "url": "http://api:8000/v1/debug/feedback-report"
        },
        "name": "Get Feedback Report",
        "type": "n8n-nodes-base.httpRequest",
        "position": [450, 300]
      },
      {
        "parameters": {
          "conditions": {
            "number": [{"value1": "={{ $json.health_score }}", "operation": "smaller", "value2": 70}]
          }
        },
        "name": "Health Check",
        "type": "n8n-nodes-base.if",
        "position": [650, 300]
      }
    ],
    "connections": {
      "Daily Trigger": {"main": [[{"node": "Get Feedback Report", "type": "main", "index": 0}]]},
      "Get Feedback Report": {"main": [[{"node": "Health Check", "type": "main", "index": 0}]]}
    }
  },
  {
    "name": "KG Stats Sync",
    "nodes": [
      {
        "parameters": {
          "rule": {"interval": [{"field": "hours", "hoursInterval": 6}]}
        },
        "name": "Every 6 Hours",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [250, 300]
      },
      {
        "parameters": {
          "url": "http://api:8000/v1/kg/stats"
        },
        "name": "Get KG Stats",
        "type": "n8n-nodes-base.httpRequest",
        "position": [450, 300]
      }
    ],
    "connections": {
      "Every 6 Hours": {"main": [[{"node": "Get KG Stats", "type": "main", "index": 0}]]}
    }
  },
  {
    "name": "User Query Recommendation",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "user-query",
          "responseMode": "lastNode"
        },
        "name": "Webhook",
        "type": "n8n-nodes-base.webhook",
        "position": [250, 300]
      },
      {
        "parameters": {
          "url": "http://api:8000/v1/recommend/track",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {"name": "user_id", "value": "={{ $json.user_id }}"},
              {"name": "behavior_type", "value": "query"},
              {"name": "query", "value": "={{ $json.query }}"}
            ]
          }
        },
        "name": "Track Query",
        "type": "n8n-nodes-base.httpRequest",
        "position": [450, 300]
      },
      {
        "parameters": {
          "url": "http://api:8000/v1/recommend?user_id={{ $json.user_id }}&limit=5"
        },
        "name": "Get Recommendations",
        "type": "n8n-nodes-base.httpRequest",
        "position": [650, 300]
      }
    ],
    "connections": {
      "Webhook": {"main": [[{"node": "Track Query", "type": "main", "index": 0}]]},
      "Track Query": {"main": [[{"node": "Get Recommendations", "type": "main", "index": 0}]]}
    }
  }
]
